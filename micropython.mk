MOD_UCRYPTOGRAPHY_DIR := $(USERMOD_DIR)

MBEDTLS_DIR := $(TOP)/lib/mbedtls

CFLAGS_USERMOD += -DMICROPY_PY_UCRYPTOGRAPHY_ED25519=1
CFLAGS_USERMOD += -DC25519_USE_MBEDTLS_SHA512=1

CFLAGS_USERMOD += -I$(MBEDTLS_DIR)/include
CFLAGS_USERMOD += -I$(MBEDTLS_DIR)/library
CFLAGS_USERMOD += -I$(MOD_UCRYPTOGRAPHY_DIR)
ifeq ($(MCU_SERIES),wb)
    CFLAGS_USERMOD += -I$(MOD_UCRYPTOGRAPHY_DIR)/hw_alts/$(MCU_SERIES)/
    CFLAGS_USERMOD += -DMBEDTLS_GCM_ALT
    CFLAGS_USERMOD += -DMBEDTLS_AES_ALT
    CFLAGS_USERMOD += -DMBEDTLS_RSA_ALT
    CFLAGS_USERMOD += -DMBEDTLS_ECP_ALT
    CFLAGS_USERMOD += -DMBEDTLS_ECDSA_VERIFY_ALT
    CFLAGS_USERMOD += -DMBEDTLS_ECDSA_SIGN_ALT
endif
CFLAGS_USERMOD += -I$(MOD_UCRYPTOGRAPHY_DIR)/BLAKE2/ref
CFLAGS_USERMOD += -I$(MOD_UCRYPTOGRAPHY_DIR)/c25519/src

SRC_USERMOD += $(MOD_UCRYPTOGRAPHY_DIR)/modcryptography.c
SRC_USERMOD += $(MOD_UCRYPTOGRAPHY_DIR)/BLAKE2/ref/blake2s-ref.c
SRC_USERMOD += $(MOD_UCRYPTOGRAPHY_DIR)/c25519/src/c25519.c
SRC_USERMOD += $(MOD_UCRYPTOGRAPHY_DIR)/c25519/src/ed25519.c
SRC_USERMOD += $(MOD_UCRYPTOGRAPHY_DIR)/c25519/src/edsign.c
SRC_USERMOD += $(MOD_UCRYPTOGRAPHY_DIR)/c25519/src/f25519.c
SRC_USERMOD += $(MOD_UCRYPTOGRAPHY_DIR)/c25519/src/fprime.c
SRC_USERMOD += $(MOD_UCRYPTOGRAPHY_DIR)/c25519/src/morph25519.c
SRC_USERMOD += $(MOD_UCRYPTOGRAPHY_DIR)/c25519/src/sha512.c

ifeq ($(MCU_SERIES),wb)
    SRC_USERMOD += $(MOD_UCRYPTOGRAPHY_DIR)/hw_alts/$(MCU_SERIES)/aes_alt.c
    SRC_USERMOD += $(MOD_UCRYPTOGRAPHY_DIR)/hw_alts/$(MCU_SERIES)/gcm_alt.c
    SRC_USERMOD += $(MOD_UCRYPTOGRAPHY_DIR)/hw_alts/$(MCU_SERIES)/ecp_curves_alt.c
    SRC_USERMOD += $(MOD_UCRYPTOGRAPHY_DIR)/hw_alts/$(MCU_SERIES)/ecp_alt.c
    SRC_USERMOD += $(MOD_UCRYPTOGRAPHY_DIR)/hw_alts/$(MCU_SERIES)/rsa_alt.c
    SRC_USERMOD += $(MOD_UCRYPTOGRAPHY_DIR)/hw_alts/$(MCU_SERIES)/ecdsa_alt.c
    HAL_SRC_C += $(addprefix $(STM32LIB_HAL_BASE)/Src/stm32$(MCU_SERIES)xx_,\
        hal_cryp.c \
        hal_cryp_ex.c \
        hal_pka.c \
    )
endif
